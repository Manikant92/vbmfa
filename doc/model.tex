\documentclass[a4paper]{article}
\usepackage{fullpage}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{tikz}
\usetikzlibrary{positioning}
\usepackage{booktabs}

\author{Angermueller Christof}
\date{20 January 2014}
\title{Variational Inference for Bayesian Mixture of Factor Analysers}

\begin{document}
\maketitle

\newcommand{\bs}{\boldsymbol}
\newcommand{\Xy}{\bs{y}^{n,g}}
\newcommand{\Xx}{\bs{x}^{n,g}}
\newcommand{\Xz}{\bs{z}^{n,g}}
\newcommand{\Xp}{\bs{\pi}}
\newcommand{\Xl}{\Lambda^s}
\newcommand{\Xn}{\bs{\nu}^s}
\newcommand{\Xe}{\Psi}
\newcommand{\Xa}{\alpha}
\newcommand{\Xc}{\Xl{\Xl}^T}

\section{Notations}
\begin{table}[h]
  \begin{center}
  \begin{tabular}{ll}
    \toprule
    Symbol & Description \\ \hline
    $P$ & Dimensionality data \\
    $Q$ & Number of factors/components \\
    $S$ & Number of factor analysers \\
    $N$ & Number of samples \\
    $G$ & Number of genes \\
    \bottomrule
  \end{tabular}
  \end{center}
\end{table}

\section{Factor analysis}
\begin{table}[h]
  \begin{center}
  \begin{tabular}{lll}
    \toprule
    Symbol & Dimension & Description \\ \hline
    $\bs{y}$ & $P$ & Observed data vector \\
    $\bs{x}$ & $Q$ & Latent factors \\
    $\bs{\eta}$ & $P$ & Random Gaussian noise \\
    $\Lambda$ & $P \times Q$ & Factor loading matrix \\
    $\Lambda_{:q}$ & $P$ & Column loading matrix/principal component \\
    $\bs{z}$ & $Q$ & Indicators factor analysers \\
    $\Xp$ & $S$ & Mixing proportions \\
    \bottomrule
  \end{tabular}
\end{center}
\end{table}
\begin{align}
  P(\bs{x})=\mathcal{N}(\bs{x}|0,I_Q)
\end{align}
\begin{align}
  P(\bs{\eta})=\mathcal{N}(\bs{\eta}|0,\Psi)
\end{align}

\subsection{Single factor analyser}
\begin{align}
  \bs{y}=\Lambda\bs{x}+\bs{\eta}
\end{align}
\begin{align}
  P(\bs{y}|\bs{x},\Lambda,\Psi)=\mathcal{N}(\bs{y}|\Lambda\bs{x},\Lambda\Lambda^T+\Psi)
\end{align}

\subsection{Mixture factor analysers}
\begin{align}
  \bs{y}=\bs{\eta}+\sum_{s=1}^S\Lambda^s\bs{x} P(z_s|\bs{\pi})
\end{align}
\begin{align}
  P(\bs{y}|\bs{x},\Lambda,\Psi)=\sum_{s=1}^S\mathcal{N}(\bs{y}|\Lambda\bs{x},\Lambda^s{\Lambda^s}^T+\Psi)P(z_s|\bs{\pi})
\end{align}

\newpage
\section{Gene expression model}
\begin{table}[h]
  \begin{center}
  \begin{tabular}{lll}
    \toprule
    Symbol & Dimension & Description \\ \hline
    $\Xy$ & $P$ & Counts sample $n$ gene $g$ \\
    $\Xx$ & $Q$ & Factors sample $n$ gene $g$ \\
    $\Xz$ & $Q$ & Indicators factor analysers sample $n$ gene $g$ \\
    $\Xp$ & $S$ & Mixing proportions \\
    $\Xl$ & $P \times Q$ & Loading matrix factor analyser $s$ \\
    $\Xn$ & $Q$ & Precisions components factor analyser $s$ \\ \hline
    $a$ & $1$ & Shape gamma distribution \\
    $b$ & $1$ & Rate gamma distribution \\
    $\Xa$ & $1$ & Dirichlet parameter \\
    $\Xe$ & $Q \times Q$ & Noise matrix \\
    \bottomrule
  \end{tabular}
\end{center}
\end{table}
\begin{figure}[h]
  \begin{center}
    \begin{tikzpicture}
      \tikzstyle{sVar}=[circle, draw=black, very thick];
      \tikzstyle{sPlate}=[rectangle, dashed, draw=black, thick, align=flush right];
      \tikzstyle{sHyper}=[rectangle, draw=black, thick];
      \tikzstyle{sDep}=[->, thick];
      \node[sPlate, text width=6cm, text height=4.5cm] (Pn) {$n=1,...,N$};
      \node[sPlate, text width=5.5cm, text height=3.5cm, below=.5cm of Pn.north] (Pg) {$g=1,...,G$};
      \node[sVar, below=.75cm of Pg.north, fill=gray!50] (Y) {$\Xy$};
      \node[sVar, right=1cm of Y] (Z) {$\Xz$};
      \node[sVar, below=.2cm of Z] (X) {$\Xx$};
      \node[sVar, right=1.0cm of Z] (Pi) {$\Xp$};
      \node[sHyper, left=3cm of Y] (Psi) {$\Xe$};
      \node[sHyper, right=1cm of Pi] (Alpha) {$\Xa$};
      \node[above=.5 of Pn.north] (LambdaX) {...};
      \node[sVar, left=1cm of LambdaX] (Lambda1) {$\Lambda^1$};
      \node[sVar, right=1cm of LambdaX] (LambdaS) {$\Lambda^S$};
      \node[above=1cm of LambdaX] (NuX) {...};
      \node[sVar, left=1cm of NuX] (Nu1) {$\bf{\nu}^1$};
      \node[sVar, right=1cm of NuX] (NuS) {$\bf{\nu}^S$};
      \node[sHyper, above=.5cm of NuX] (Gamma) {$a,b$};
      \draw[sDep] (Z) -- (Y);
      \draw[sDep] (X) -- (Y);
      \draw[sDep] (Psi) -- (Y);
      \draw[sDep] (Pi) -- (Z);
      \draw[sDep] (Alpha) -- (Pi);
      \draw[sDep] (Lambda1) -- (Y);
      \draw[sDep] (LambdaS) -- (Y);
      \draw[sDep] (Nu1) -- (Lambda1);
      \draw[sDep] (NuS) -- (LambdaS);
      \draw[sDep] (Gamma) -- (Nu1);
      \draw[sDep] (Gamma) -- (NuS);
    \end{tikzpicture}
    \caption{Graphical model}
  \end{center}
\end{figure}

\subsection{Conditional probability distributions}
\begin{align}
  P(\Xy|\Xx,\Xz,\Xp,\Lambda)=\sum_{s=1}^S\mathcal{N}(\Xy|\Xl\Xx,\Xc+\Xe)P(z_s^{n,g}|\Xp)
\end{align}
\begin{align}
  P(\Xx)=N(\Xx|0,I_{Q})
\end{align}
\begin{align}
  P(\Xz|\Xp)=Mult(\Xz|\Xp)
\end{align}
\begin{align}
  P(\Xp|\alpha)=Dir(\Xp|\alpha)
\end{align}
\begin{align}
  P(\Xl)=\prod_{q=1}^Q N({\Xl}_{:q}|0,I_P\frac{1}{\nu_q^{s}})
\end{align}
\begin{align}
  P(\Xn)=\prod_{q=1}^Q\Gamma(\nu_q^s|a,b)
\end{align}


\end{document}
